# DDD实战课

--------------------------------

## 开篇词 | 学好了DDD 你能做什么

*DDD、微服务和中台之间的关系*

# 基础篇

## 1、领域驱动设计：微服务设计为什么要使用DDD

### 软件架构模式的演进

单机阶段-->集中式阶段-->分布式微服务架构.  

### 微服务设计和拆分的困境

微服务拆分困境产生的根本原因是不知道业务或者微服务的边界是什么。如果确认业务边界和应用边界，这个困境就迎难而解了。  
DDD核心思想是通过领域驱动设计的方法定义领域模型，从而确定业务和应用边界，保证业务模型和代码模型的一致性。

### 为什么DDD适合微服务

DDD是一种处理高度复杂领域的设计思想，它试图分离技术实现的复杂性，围绕业务概念构建领域模型来控制业务的复杂性，以解决软件难以理解难以演进的问题。  
**DDD包括战术设计和战略设计**  
战术设计主要是从业务视角出发，构建业务领域模型，划分领域边界，建立通用语言的限界上下文。  
战略设计侧重于领域模型的技术实现，完成软件的开发和设计，包括：聚合根、实体、值对象、领域服务、应用服务和资源库等代码逻辑的设计和实现。  
**确定领域模型和微服务的边界**  

1. 在风暴事件中梳理业务过程的用户操作、事件及外部依赖等关系，提取实体等领域对象。
2. 根据领域实体之间的业务关联性，将业务紧密相关的实体进行组合形成聚合，同时确定聚合根、值对象和实体。聚合之间的边界是逻辑边界。
3. 根据业务和语义边界等因素，将一个或多个聚合划在一个限界上下文中，形成领域模型。这一层可能是微服务的边界，是物理边界。
   
   ### DDD和微服务的关系
   
   DDD是一种架构的设计方法，微服务是一种架构风格，两者都是强调从业务出发，其核心要义是根据业务发展，合理划分领域边界，持续调整现有架构，优化现有代码，以保持架构和代码的生命力，也就是演进式架构。  
   DDD：从业务视角划分领域边界，构建通用语言进行高效沟通，通过业务抽象，建立领域模型，维持业务和代码的逻辑一致性。  
   微服务：主要关注进程间通信、容错和故障隔离，实现去中心化数据管理和中心化服务管理，关注微服务独立开发、测试、构建和部署。
   
   ## 2、领域、子域、核心域、通用域和支撑域
   
   ### 如何理解领域和子域
   
   DDD领域是用来限定业务边界和范围的。
   
   ### 如何理解核心域、通用域和支撑域
   
   子域根据自身重要性和功能属性划分为三个子域。  
   `核心域`：决定产品和公司核心竞争力。  
   `通用域`：被多个子域使用的通用功能子域，没有太多的个性化诉求。  
   `支撑域`：非核心域和通用域。  
   通过领域划分，区分不同子域在公司内的不同功能属性和重要性，从而公司对不同子域采用不同的资源投入和建设策略，关注度也不一样。
   
   ## 3、限界上下文：定义领域边界的利器
   
   ### 什么是通用语言？
   
   通用语言包含术语和用例场景，并且能够直接反映在代码中。通用语言中的名词可以给领域对象命名，而动词则表示一个动作或事件，对应领域事件或命令。  
   1.事件风暴--> 2.领域故事分析--> 3.提取领域对象--> 4.领域对象与代码模型映射--> 5.代码落地  
   
   ### 什么是限界上下文？
   
   限界：领域的边界，上下文是语义环境。用来封装通用语言和领域对象，提供上下文环境，保证在领域之内的一些术语、业务相关对象（通用语言）有一个确切的含义，没有二义性。  
   限界上下文就是用来细分领域，从而定义通用语言所在的边界。
   
   ### 限界上下文和微服务的关系
   
   限界上下文是微服务设计和拆分的主要依据。在领域模型中，如果不考虑技术异构、团队沟通等因素，一个限界上下文理论上可以设计为一个微服务。
   
   ## 4、实体和值对象：从领域模型的基础单元看系统设计
   
   ### 实体
4. 业务形态：战略设计：实体是领域模型的重要对象。领域模型：实体是多个属性，操作或行为的空载体。事件风暴：我们可以根据命令、操作或者事件，找到这些行为的业务实体对象。
5. 代码形态：实体类，这个类包含实体的属性和方法，通过这些方法实现实体自身的业务逻辑。       
6. 运行形态：实体以DD的形式存在，每个实体对象都有唯一的ID。
7. 数据库形态：DDD是先构建领域模型，针对时机业务场景构建实体对象和行为，再将实体对象映射到数据持久化对象。
   
   ### 值对象
   
   通过对象属性值来识别的对象，它将多个相关属性组合为一个整体概念。
8. 业务形态：是DDD领域模型中的一个基础对象，包含了若干个属性，和实体一起构成聚合。
9. 代码形态：1）类属性；2）属性集合，Class类。
10. 运行形态：值对象嵌入实体，1）属性嵌入；2）序列化大对象。
11. 数据库形态：在领域建模时，可以将部分对象设计为值对象，保留对象的业务含义，同时减少实体的数量；在数据建模时，可以将地址的属性值嵌入实体数据库表中。
    
    ### 实体和值对象的关系
    
    实体和值对象是微服务底层最基础的对象，一起实现实体最基本的核心领域逻辑。  
    值对象和实体在某些场景可以互换。
    
    ## 5、聚合和聚合根：怎样设计聚合
    
    ### 聚合
    
    领域模型内的实体和值对象就好比个体，而能让实体和值对象协同工作的组织就是聚合。用来确保这些领域对象在实现共同的业务逻辑时，能保证数据的一致性。  
    聚合是由业务和逻辑紧密联系的实体和值对象组合而成，聚合是数据修改和持久化的基本单元，每一个聚合对应一个仓储，实现数据的持久化。  
    聚合内实体以充血模型体现个体业务能力，以及业务逻辑的高内聚，跨多个实体的业务逻辑通过领域服务来实现，跨多个聚合的业务逻辑通过应用服务来实现。
    
    ### 聚合根
    
    聚合根，也称为根实体，它不仅是实体，还是聚合的管理者，在聚合内部负责协调实体和值对象按照固定的业务规则协同完成共同的业务逻辑。
    
    ### 怎样设计聚合？
12. 采用时间风暴，梳理实体和值对象；
13. 找出聚合根，是否有独立的生命周期？是否全局唯一ID？是否可以创建或修改其他对象？是否有专门的模块来管理这个实体；
14. 根据业务单一和高内聚原则，找出聚合根关联的所有紧密依赖的实体和值对象。
15. # 进阶篇
    
    ## 6、领域事件：解耦微服务的关键
    
    ## 7、DDD分层架构：有效降低层与层之间的依赖
    
    ## 8、微服务架构模型：几种常见模型的对比和分析
    
    ## 9、中台：数字转型到底应该共享什么？
    
    ## 10、DDD、中台和微服务：他们是如何协作的？
    
    # 实战篇
    
    ## 11、DDD实践：如何用DDD重构中台业务模型？
    
    ## 12、领域建模：如何用事件风暴建领域模型？
    
    ## 13、代码模型（上）：如何使用DDD设计微服务代码模型？
    
    ## 14、代码模型（下）：如何保证领域名与代码模型的一致性？
    
    ## 15、 边界：微服务的各种边界在架构演进中的作用？
    
    ## 16、视图：如何实现服务和数据在微服务各层的协作？
    
    ## 17、从后端到前端：微服务后，前端如何设计？
    
    ## 18、知识点串讲：基于DDD的微服务设计实例
    
    ## 19、总结（1）：微服务设计和拆分要坚持那些原则？
    
    ## 20、总结（2）：分布式架构关键设计10问
